language: cpp
compiler: gcc
sudo: true

before_script:
  - export DEVROOT=${TRAVIS_BUILD_DIR}
  - sudo apt-get update
  - sudo apt-get --yes install mpich
  - git clone https://github.com/SCOREC/core.git
  - cd core
  - git checkout develop
  - mkdir -p build
  - cd build
  - cmake .. -DCMAKE_C_COMPILER=mpicc -DCMAKE_CXX_COMPILER=mpicxx -DCMAKE_INSTALL_PREFIX=${DEVROOT}/install -DIS_TESTING=OFF -DCMAKE_BUILD_TYPE=Release
  - make && make install
  - cd ..

script:
  - cd SCOREC/msi
  - mkdir -p build
  - cp example-config.sh build/config.sh
  - cd build
  - ./config.sh
  - make
  - ctest

before_install:
  - test -n $CC  && unset CC
  - test -n $CXX && unset CXX